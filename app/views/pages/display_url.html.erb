<h1> Chat Form </h1>

<div ng-app="app">
  <div ng-controller="chatsCtrl"
       ng-init="init('<%= @url %>')">

    {{ 1 + 1 }}
    <div id="chatbox">

    </div>


  <!-- <input type="hidden" name="url" ng-value="{{url}}"> -->
  <input name="message" ng-model="message">
  <a href="#" class="btn btn-primary" ng-click="chat(message, url)">Chat</a>

<!-- <iframe class="chat-frame" src="<%= @url %>"></iframe> -->
  </div>
</div>

<script src="//js.pusher.com/2.2/pusher.min.js" type="text/javascript"></script>
    <script type="text/javascript">
      // Enable pusher logging - don't include this in production
      // Pusher.log = function(message) {
      //   if (window.console && window.console.log) {
      //     window.console.log(message);
      //   }
      // };

      var pusher = new Pusher("<%= ENV['PUSHER_KEY'] %>");
      var channel = pusher.subscribe('<%= @url.gsub("http://", "") %>');
      channel.bind('my_event', function(data) {
        console.log(data.message);
        $("#chatbox").append(data.message + "\r");
      });
    </script>
  </script>
